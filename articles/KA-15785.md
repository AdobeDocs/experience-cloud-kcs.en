---
title: Optimize SQL query generated in database update wizard
description: Learn how to solve the Adobe Campaign Classic issue where new columns need to be added to an existing schema.
solution: Campaign,Campaign Classic v7
product: Campaign,Campaign Classic v7
applies-to: Campaign Classic,Campaign,Campaign Classic v7
keywords: KCS, Campaign Classic V7, optimize SQL query generated, database update wizard
resolution: Resolution
internal-notes: It can be helpful when dealing with database update issues with big tables
bug: true
article-created-by: Tanay Sharma .
article-created-date: 6/19/2024 9:38:25 AM
article-published-by: Tanay Sharma .
article-published-date: 6/19/2024 9:49:12 AM
version-number: 5
article-number: KA-15785
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=533de7a7-1f2e-ef11-840b-6045bd0065b6
exl-id: 73e8701c-88e5-4b73-8c55-90eaee26d2ac
---
# Optimize SQL query generated in database update wizard


Learn how to add an integer field to an existing schema when records already exist and how to optimize the SQL query generated by the application to be efficient for Postgres SQL.

## Description {#description}


### <b>Environment</b>

- Adobe Campaign
- Adobe Campaign Classic


### Issue/Symptoms

In most of the Adobe Campaign builds including the Gold Standard 9032 ones, you might encounter multiple issues when adding new columns to an existing schema.

 The scope of this article is to address one specific problem which is related to:

- Adding an integer field to an existing schema when records already exist.
- Optimize the SQL query generated by the application to an efficient one for Postgres SQL.



## Resolution {#resolution}


When adding an integer column, you get the SQL statement generated similar to this:


```
ALTER TABLE NmsRecipient ADD <column_name> SMALLINT;
UPDATE NmsRecipient SET <column_name> = 0;
ALTER TABLE NmsRecipient ALTER COLUMN <column_name> SET Default 0;
ALTER TABLE NmsRecipient ALTER COLUMN i<column_name> SET NOT NULL;
```


The problem here is that there are four commands executed in the database in parallel, which can cause performance issues or a deadlock.
The solution is to condense these four commands into one and still make the same changes as below:


```
ALTER TABLE NmsRecipient ADD iFichierLiveDataCliqueurs SMALLINT NOT NULL SET Default 0 ;
```


It does all the changes required, adding the column, setting the default, set `NOT NULL`, and also setting the value of existing records to *0* because of the `NOT NULL` constraint.

<b>NOTE:</b>

If there are multiple integer columns that need to be added, add them one by one and run the database wizard for each change.

This is to ensure smooth operation since the statement also updates all <b>existing </b>records to *0*, which can take time depending on the number of records.
<br>Cause<br>
This can happen when you, for example, have an existing recipient table or any other table which already has in excess of one million records.

If you now need to add one extra column to that table, which is of data type Integer. In that case, you add that column in the schema definition and want to commit the changes in the database.

While updating the database, the database encounters a deadlock, or the query blocks other operations.

This is mainly due to updating of all records to *0* based on the SQL command generated by the database wizard.
